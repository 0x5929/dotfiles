#!/usr/bin/env bash
set -euo pipefail

STATE_FILE="${XDG_CACHE_HOME:-$HOME/.cache}/eww_playerctl_selected"
mkdir -p "$(dirname "$STATE_FILE")"

mapfile -t players < <(playerctl -l 2>/dev/null || true)

# Nothing to do if no players
((${#players[@]} == 0)) && exit 0

current=""
if [[ -f "$STATE_FILE" ]]; then
  current="$(<"$STATE_FILE")"
fi

# Default: first player
next="${players[0]}"

# If current is in the list, move to the next one (wrap around)
for i in "${!players[@]}"; do
  if [[ "${players[$i]}" == "$current" ]]; then
    idx=$(( (i + 1) % ${#players[@]} ))
    next="${players[$idx]}"
    break
  fi
done

printf '%s\n' "$next" >"$STATE_FILE"

