#!/usr/bin/env bash
set -euo pipefail

STATE_FILE="${XDG_CACHE_HOME:-$HOME/.cache}/eww_playerctl_selected"

get_selected_player() {
  if [[ -f "$STATE_FILE" ]]; then
    local sel
    sel="$(<"$STATE_FILE")"
    if [[ -n "$sel" ]] && playerctl -p "$sel" status >/dev/null 2>&1; then
      printf '%s\n' "$sel"
      return 0
    fi
  fi

  # fallback: first player
  playerctl -l 2>/dev/null | head -n 1 || true
}

player="$(get_selected_player || true)"

if [[ -n "${player:-}" ]]; then
  playerctl -p "$player" play-pause
else
  # last fallback: all players (old behavior)
  playerctl play-pause || true
fi

